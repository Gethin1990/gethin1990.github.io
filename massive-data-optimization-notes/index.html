<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>海量数据优化笔记 - Gethin</title><meta name=Description content="格心"><meta property="og:title" content="海量数据优化笔记"><meta property="og:description" content="海量数据优化 1. 合理使用索引 索引是数据库中重要的数据结构，它的根本目的就是为了提高查询效率。现在大多数"><meta property="og:type" content="article"><meta property="og:url" content="https://gethin1990.github.io/massive-data-optimization-notes/"><meta property="og:image" content="https://gethin1990.github.io/logo.png"><meta property="article:published_time" content="2020-04-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-05-31T16:03:02+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gethin1990.github.io/logo.png"><meta name=twitter:title content="海量数据优化笔记"><meta name=twitter:description content="海量数据优化 1. 合理使用索引 索引是数据库中重要的数据结构，它的根本目的就是为了提高查询效率。现在大多数"><meta name=application-name content="Gethin"><meta name=apple-mobile-web-app-title content="Gethin"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://gethin1990.github.io/massive-data-optimization-notes/><link rel=prev href=https://gethin1990.github.io/gatsby-basic-knowledge-3/><link rel=next href=https://gethin1990.github.io/python-learning-notes/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><meta name=baidu-site-verification content="jPLcqjD4p8"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"海量数据优化笔记","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/gethin1990.github.io\/massive-data-optimization-notes\/"},"image":["https:\/\/gethin1990.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"数据","wordcount":4295,"url":"https:\/\/gethin1990.github.io\/massive-data-optimization-notes\/","datePublished":"2020-04-27T00:00:00+00:00","dateModified":"2021-05-31T16:03:02+08:00","publisher":{"@type":"Organization","name":"gethin","logo":"https:\/\/cdn.jsdelivr.net\/gh\/Gethin1990\/PicBed\/BlogImg\/g.PNG"},"author":{"@type":"Person","name":"Gethin"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Gethin><span class=header-title-pre><i class="fas fa-cloud-sun"></i></span><span class=header-title-post>Cloud & Sun</span></a></div><div class=menu style=overflow:visible><div class=menu-inner><a class=menu-item href=/ title=首页><i class="fas fa-home fa-fw"></i>首页</a>
<a class=menu-item href=/categories/><i class="fas fa-th-list fa-fw"></i>分类</a>
<a class=menu-item href=/tags/><i class="fas fa-tags fa-fw"></i>标签</a>
<a class=menu-item href=/posts/ title=所有文章><i class="fas fa-archive fa-fw"></i>归档</a><div class="dropdown menu-item" style=display:inline><a class=btn href=javascript:void(0); role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><i class="fas fa-fan fa-fw"></i>分享</a><div class=dropdown-menu style=display:none><a class=dropdown-item href=/memories/><i class="fas fa-database fa-fw"></i>记忆</a>
<a class=dropdown-item href=/booklist/><i class="fas fa-file-alt fa-fw"></i>书单</a>
<a class=dropdown-item href=https://note.youdao.com rel="noopener noreffer" target=_blank><i class="fas fa-book fa-fw"></i>笔记</a>
<a class=dropdown-item href=/websites/><i class="fas fa-globe fa-fw"></i>网站</a></div></div><div class="dropdown menu-item" style=display:inline><a class=btn href=javascript:void(0); role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><i class="fas fa-door-closed fa-fw"></i>传送门</a><div class=dropdown-menu style=display:none><a class=dropdown-item href=/message-board/><i class="fas fa-comments fa-fw"></i>留言板</a>
<a class=dropdown-item href=/milestone/><i class="fas fa-monument fa-fw"></i>里程碑</a>
<a class=dropdown-item href=/links/><i class="fas fa-user-friends fa-fw"></i>友情链</a></div></div><a class=menu-item href=/about/><i class="fas fa-user-secret fa-fw"></i>关于</a>
<span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Gethin><span class=header-title-pre><i class="fas fa-cloud-sun"></i></span><span class=header-title-post>Cloud & Sun</span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/ title=首页><i class="fas fa-home fa-fw"></i>首页</a>
<a class=menu-item href=/categories/><i class="fas fa-th-list fa-fw"></i>分类</a>
<a class=menu-item href=/tags/><i class="fas fa-tags fa-fw"></i>标签</a>
<a class=menu-item href=/posts/ title=所有文章><i class="fas fa-archive fa-fw"></i>归档</a><div class="dropdown menu-item"><a class=btn href=javascript:void(0); role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><i class="fas fa-fan fa-fw"></i>分享</a><div class="dropdown-menu dropdown-menu-mobile" style=display:none><a class=dropdown-item href=/memories/><i class="fas fa-database fa-fw"></i>记忆</a>
<a class=dropdown-item href=/booklist/><i class="fas fa-file-alt fa-fw"></i>书单</a>
<a class=dropdown-item href=https://note.youdao.com rel="noopener noreffer" target=_blank><i class="fas fa-book fa-fw"></i>笔记</a>
<a class=dropdown-item href=/websites/><i class="fas fa-globe fa-fw"></i>网站</a></div></div><div class="dropdown menu-item"><a class=btn href=javascript:void(0); role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><i class="fas fa-door-closed fa-fw"></i>传送门</a><div class="dropdown-menu dropdown-menu-mobile" style=display:none><a class=dropdown-item href=/message-board/><i class="fas fa-comments fa-fw"></i>留言板</a>
<a class=dropdown-item href=/milestone/><i class="fas fa-monument fa-fw"></i>里程碑</a>
<a class=dropdown-item href=/links/><i class="fas fa-user-friends fa-fw"></i>友情链</a></div></div><a class=menu-item href=/about/><i class="fas fa-user-secret fa-fw"></i>关于</a>
<a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">海量数据优化笔记</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://gethin.online/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Gethin</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E6%95%B0%E6%8D%AE%E4%B8%8E%E7%AE%97%E6%B3%95/><i class="far fa-folder fa-fw"></i>数据与算法</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-04-27>2020-04-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4295 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 9 分钟&nbsp;<span id=/massive-data-optimization-notes/ class=leancloud_visitors data-flag-title=海量数据优化笔记>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/Gethin1990/PicBed/BlogImg/mountains.jpg data-srcset="https://cdn.jsdelivr.net/gh/Gethin1990/PicBed/BlogImg/mountains.jpg, https://cdn.jsdelivr.net/gh/Gethin1990/PicBed/BlogImg/mountains.jpg 1.5x, https://cdn.jsdelivr.net/gh/Gethin1990/PicBed/BlogImg/mountains.jpg 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/Gethin1990/PicBed/BlogImg/mountains.jpg title=https://cdn.jsdelivr.net/gh/Gethin1990/PicBed/BlogImg/mountains.jpg></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#海量数据优化>海量数据优化</a><ul><li><a href=#1-合理使用索引>1. 合理使用索引</a></li><li><a href=#2-避免或简化排序>2. 避免或简化排序</a></li><li><a href=#3-消除对大型表行数据的顺序存取>3. 消除对大型表行数据的顺序存取</a></li><li><a href=#4-避免相关子查询>4. 避免相关子查询</a></li><li><a href=#5-避免困难的正规表达式>5. 避免困难的正规表达式</a></li><li><a href=#6使用临时表加速查询>6.使用临时表加速查询</a></li><li><a href=#7-用排序来取代非顺序存取>7. 用排序来取代非顺序存取</a></li></ul></li><li><a href=#百万数据查询优化技巧三十则>百万数据查询优化技巧三十则</a></li><li><a href=#常用sql>常用SQL</a><ul><li><a href=#查询带关键字的存储过程>查询带关键字的存储过程</a></li><li><a href=#查询带关键字的列名>查询带关键字的列名</a></li><li><a href=#查询带关键字的表名>查询带关键字的表名</a></li><li><a href=#查询带关键字的函数名>查询带关键字的函数名</a></li><li><a href=#查询带关键字的视图>查询带关键字的视图</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=海量数据优化>海量数据优化</h2><h3 id=1-合理使用索引>1. 合理使用索引</h3><p>索引是数据库中重要的数据结构，它的根本目的就是为了提高查询效率。现在大多数的数据库产品都采用 IBM 最先提出的 ISAM 索引结构。索引的使用要恰到好处，其使用原则如下：</p><ul><li>在经常进行连接，但是没有指定为外键的列上建立索引，而不经常连接的字段则由优化器自动生成索引。</li><li>在频繁进行排序或分组（即进行 group by 或 order by 操作）的列上建立索引。</li><li>在条件表达式中经常用到的不同值较多的列上建立检索，在不同值少的列上不要建立索引。比如在雇员表的“性别”列上只有“男”与“女”两个不同值，因此就无必要建立索引。如果建立索引不但不会提高查询效率，反而会严重降低更新速度。</li><li>如果待排序的列有多个，可以在这些列上建立复合索引（compound index）。</li><li>使用系统工具。如 Informix 数据库有一个 tbcheck 工具，可以在可疑的索引上进行检查。在一些数据库服务器上，索引可能失效或者因为频繁操作而使得读取效率降低，如果一个使用索引的查询不明不白地慢下来，可以试着用 tbcheck 工具检查索引的完整性，必要时进行修复。另外，当数据库表更新大量数据后，删除并重建索引可以提高查询速度。</li></ul><h3 id=2-避免或简化排序>2. 避免或简化排序</h3><p>应当简化或避免对大型表进行重复的排序。当能够利用索引自动以适当的次序产生输出时，优化器就避免了排序的步骤。以下是一些影响因素：</p><ul><li>索引中不包括一个或几个待排序的列；</li><li>group by 或 order by 子句中列的次序与索引的次序不一样；</li><li>排序的列来自不同的表。</li></ul><p>为了避免不必要的排序，就要正确地增建索引，合理地合并数据库表（尽管有时可能影响表的规范化，但相对于效率的提高是值得的）。如果排序不可避免，那么应当试图简化它，如缩小排序的列的范围等。</p><h3 id=3-消除对大型表行数据的顺序存取>3. 消除对大型表行数据的顺序存取</h3><p>在嵌套查询中，对表的顺序存取对查询效率可能产生致命的影响。比如采用顺序存取策略，一个嵌套 3 层的查询，如果每层都查询 1000 行，那么这个查询就要查询 10 亿行数据。避免这种情况的主要方法就是对连接的列进行索引。<br>例如，两个表：学生表（学号、姓名、年龄……）和选课表（学号、课程号、成绩）。如果两个表要做连接，就要在“学号”这个连接字段上建立索引。<br>还可以使用并集来避免顺序存取。尽管在所有的检查列上都有索引，但某些形式的 where 子句强迫优化器使用顺序存取。下面的查询将强迫对 orders 表执行顺序操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>orders</span> <span class=k>WHERE</span> <span class=p>(</span><span class=n>customer_num</span><span class=o>=</span><span class=mi>104</span> <span class=k>AND</span> <span class=n>order_num</span><span class=o>&gt;</span><span class=mi>1001</span><span class=p>)</span> <span class=k>OR</span> <span class=n>order_num</span><span class=o>=</span><span class=mi>1008</span>
</code></pre></td></tr></table></div></div><p>虽然在 customer_num 和 order_num 上建有索引，但是在上面的语句中优化器还是使用顺序存取路径扫描整个表。因为这个语句要检索的是分离的行的集合，所以应该改为如下语句：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>orders</span> <span class=k>WHERE</span> <span class=n>customer_num</span><span class=o>=</span><span class=mi>104</span> <span class=k>AND</span> <span class=n>order_num</span><span class=o>&gt;</span><span class=mi>1001</span>
<span class=k>UNION</span>
<span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>orders</span> <span class=k>WHERE</span> <span class=n>order_num</span><span class=o>=</span><span class=mi>1008</span>
</code></pre></td></tr></table></div></div><p>这样就能利用索引路径处理查询。</p><h3 id=4-避免相关子查询>4. 避免相关子查询</h3><p>一个列的标签同时在主查询和 where 子句中的查询中出现，那么很可能当主查询中的列值改变之后，子查询必须重新查询一次。查询嵌套层次越多，效率越低，因此应当尽量避免子查询。如果子查询不可避免，那么要在子查询中过滤掉尽可能多的行。</p><h3 id=5-避免困难的正规表达式>5. 避免困难的正规表达式</h3><p>MATCHES 和 LIKE 关键字支持通配符匹配，技术上叫正规表达式。但这种匹配特别耗费时间。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>customer</span> <span class=k>WHERE</span> <span class=n>zipcode</span> <span class=k>LIKE</span> <span class=err>“</span><span class=mi>98</span><span class=n>_</span> <span class=n>_</span> <span class=n>_</span><span class=err>”</span>
</code></pre></td></tr></table></div></div><p>即使在 zipcode 字段上建立了索引，在这种情况下也还是采用顺序扫描的方式。如果把语句改为<code>SELECT * FROM customer WHERE zipcode >“98000”</code>，在执行查询时就会利用索引来查询，显然会大大提高速度。<br>另外，还要避免非开始的子串。例如语句：<code>SELECT * FROM customer WHERE zipcode[2，3] >“80”</code>，在 where 子句中采用了非开始子串，因而这个语句也不会使用索引。</p><h3 id=6使用临时表加速查询>6.使用临时表加速查询</h3><p>把表的一个子集进行排序并创建临时表，有时能加速查询。有助于避免多重排序操作，而且在其他方面还能简化优化器的工作。例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span> <span class=n>cust</span><span class=p>.</span><span class=n>name</span><span class=err>，</span><span class=n>rcvbles</span><span class=p>.</span><span class=n>balance</span><span class=err>，……</span><span class=n>other</span> <span class=n>columns</span>
<span class=k>FROM</span> <span class=n>cust</span><span class=err>，</span><span class=n>rcvbles</span>
<span class=k>WHERE</span> <span class=n>cust</span><span class=p>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>rcvlbes</span><span class=p>.</span><span class=n>customer_id</span>
<span class=k>AND</span> <span class=n>rcvblls</span><span class=p>.</span><span class=n>balance</span><span class=o>&gt;</span><span class=mi>0</span>
<span class=k>AND</span> <span class=n>cust</span><span class=p>.</span><span class=n>postcode</span><span class=o>&gt;</span><span class=err>“</span><span class=mi>98000</span><span class=err>”</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>cust</span><span class=p>.</span><span class=n>name</span>
</code></pre></td></tr></table></div></div><p>如果这个查询要被执行多次而不止一次，可以把所有未付款的客户找出来放在一个临时文件中，并按客户的名字进行排序：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span> <span class=n>cust</span><span class=p>.</span><span class=n>name</span><span class=err>，</span><span class=n>rcvbles</span><span class=p>.</span><span class=n>balance</span><span class=err>，……</span><span class=n>other</span> <span class=n>columns</span>
<span class=k>FROM</span> <span class=n>cust</span><span class=err>，</span><span class=n>rcvbles</span>
<span class=k>WHERE</span> <span class=n>cust</span><span class=p>.</span><span class=n>customer_id</span> <span class=o>=</span> <span class=n>rcvlbes</span><span class=p>.</span><span class=n>customer_id</span>
<span class=k>AND</span> <span class=n>rcvblls</span><span class=p>.</span><span class=n>balance</span><span class=o>&gt;</span><span class=mi>0</span>
<span class=k>ORDER</span> <span class=k>BY</span> <span class=n>cust</span><span class=p>.</span><span class=n>name</span>
<span class=k>INTO</span> <span class=n>TEMP</span> <span class=n>cust_with_balance</span>
</code></pre></td></tr></table></div></div><p>然后以下面的方式在临时表中查询：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>cust_with_balance</span> <span class=k>WHERE</span> <span class=n>postcode</span><span class=o>&gt;</span><span class=err>“</span><span class=mi>98000</span><span class=err>”</span>
</code></pre></td></tr></table></div></div><p>临时表中的行要比主表中的行少，而且物理顺序就是所要求的顺序，减少了磁盘 I/O，所以查询工作量可以得到大幅减少。<br>注意：临时表创建后不会反映主表的修改。在主表中数据频繁修改的情况下，注意不要丢失数据。</p><h3 id=7-用排序来取代非顺序存取>7. 用排序来取代非顺序存取</h3><p>非顺序磁盘存取是最慢的操作，表现在磁盘存取臂的来回移动。SQL 语句隐藏了这一情况，使得在写应用程序时很容易写出要求存取大量非顺序页的查询。<br>有些时候，用数据库的排序能力来替代非顺序的存取能改进查询。</p><h2 id=百万数据查询优化技巧三十则>百万数据查询优化技巧三十则</h2><ol><li><p>对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p></li><li><p>应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>num</span> <span class=k>is</span> <span class=k>null</span>
</code></pre></td></tr></table></div></div><p>可以在 num 上设置默认值 0，确保表中 num 列没有 null 值，然后这样查询：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>num</span><span class=o>=</span><span class=mi>0</span>
</code></pre></td></tr></table></div></div></li><li><p>应尽量避免在 where 子句中使用!=或&lt;>操作符，否则将引擎放弃使用索引而进行全表扫描。</p></li><li><p>应尽量避免在 where 子句中使用 or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>num</span><span class=o>=</span><span class=mi>10</span> <span class=k>or</span> <span class=n>num</span><span class=o>=</span><span class=mi>20</span>
</code></pre></td></tr></table></div></div><p>可以这样查询：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>num</span><span class=o>=</span><span class=mi>10</span>
<span class=k>union</span> <span class=k>all</span>
<span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>num</span><span class=o>=</span><span class=mi>20</span>
</code></pre></td></tr></table></div></div></li><li><p>in 和 not in 也要慎用，否则会导致全表扫描，如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>num</span> <span class=k>in</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>对于连续的数值，能用 between 就不要用 in 了：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>num</span> <span class=k>between</span> <span class=mi>1</span> <span class=k>and</span> <span class=mi>3</span>
</code></pre></td></tr></table></div></div></li><li><p>下面的查询也将导致全表扫描：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>name</span> <span class=k>like</span> <span class=s1>&#39;%abc%
</span></code></pre></td></tr></table></div></div><p>若要提高效率，可以考虑全文检索。</p></li><li><p>如果在 where 子句中使用参数，也会导致全表扫描。因为 SQL 只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：
<code>select id from t where num=@num</code>
可以改为强制查询使用索引：
<code>select id from t with(index(索引名)) where num=@num</code></p></li><li><p>应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：
<code>select id from t where num/2=100</code>
应改为:
<code>select id from t where num=100*2</code></p></li><li><p>应尽量避免在 where 子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=k>substring</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span><span class=p>)</span><span class=o>=</span><span class=s1>&#39;abc&#39;</span><span class=c1>--name以abc开头的id`
</span><span class=c1></span><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>datediff</span><span class=p>(</span><span class=k>day</span><span class=p>,</span><span class=n>createdate</span><span class=p>,</span><span class=s1>&#39;2005-11-30&#39;</span><span class=p>)</span><span class=o>=</span><span class=mi>0</span><span class=c1>--‘2005-11-30’生成的id
</span></code></pre></td></tr></table></div></div><p>应改为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>name</span> <span class=k>like</span> <span class=s1>&#39;abc%&#39;</span>
<span class=k>select</span> <span class=n>id</span> <span class=k>from</span> <span class=n>t</span> <span class=k>where</span> <span class=n>createdate</span><span class=o>&gt;=</span><span class=s1>&#39;2005-11-30&#39;</span> <span class=k>and</span> <span class=n>createdate</span><span class=o>&lt;</span><span class=s1>&#39;2005-12-1&#39;</span>
</code></pre></td></tr></table></div></div></li><li><p>要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</p></li><li><p>在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。</p></li><li><p>不要写一些没有意义的查询，如需要生成一个空表结构：
<code>select col1,col2 into #t from t where 1=0</code>
这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：
<code>create table #t(...)</code></p></li><li><p>很多时候用 exists 代替 in 是一个好的选择：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>num</span> <span class=k>from</span> <span class=n>a</span> <span class=k>where</span> <span class=n>num</span> <span class=k>in</span><span class=p>(</span><span class=k>select</span> <span class=n>num</span> <span class=k>from</span> <span class=n>b</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>用下面的语句替换：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>num</span> <span class=k>from</span> <span class=n>a</span> <span class=k>where</span> <span class=k>exists</span><span class=p>(</span><span class=k>select</span> <span class=mi>1</span> <span class=k>from</span> <span class=n>b</span> <span class=k>where</span> <span class=n>num</span><span class=o>=</span><span class=n>a</span><span class=p>.</span><span class=n>num</span><span class=p>)</span>
</code></pre></td></tr></table></div></div></li><li><p>并不是所有索引对查询都有效，SQL 是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL 查询可能不会去利用索引，如一表中有字段 sex，male、female 几乎各一半，那么即使在 sex 上建了索引也对查询效率起不了作用。</p></li><li><p>索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过 6 个，若太多则应考虑一些不常使用到的列上建的索引是否有必要。</p></li><li><p>应尽可能的避免更新 clustered 索引数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。</p></li><li><p>尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。</p></li><li><p>尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</p></li><li><p>任何地方都不要使用 <code>select * from t</code>，用具体的字段列表代替“*”，不要返回用不到的任何字段。</p></li><li><p>尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。</p></li><li><p>避免频繁创建和删除临时表，以减少系统表资源的消耗。</p></li><li><p>临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。</p></li><li><p>在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先 create table，然后 insert。</p></li><li><p>如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。</p></li><li><p>尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过 1 万行，那么就应该考虑改写。</p></li><li><p>使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。</p></li><li><p>与临时表一样，游标并不是不可使用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。</p></li><li><p>在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送 DONE_IN_PROC 消息。</p></li><li><p>尽量避免大事务操作，提高系统并发能力。</p></li><li><p>尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</p></li></ol><h2 id=常用sql>常用SQL</h2><h3 id=查询带关键字的存储过程>查询带关键字的存储过程</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=c1>--select string using in procedure
</span><span class=c1></span><span class=k>select</span> <span class=n>b</span><span class=p>.</span><span class=n>name</span><span class=p>,</span> <span class=n>a</span><span class=p>.</span><span class=nb>text</span> <span class=k>from</span> <span class=n>syscomments</span> <span class=n>a</span> <span class=k>left</span> <span class=k>join</span> <span class=n>sysobjects</span> <span class=n>b</span> <span class=k>on</span> <span class=n>b</span><span class=p>.</span><span class=n>id</span><span class=o>=</span><span class=n>a</span><span class=p>.</span><span class=n>id</span>
<span class=k>where</span> <span class=n>b</span><span class=p>.</span><span class=n>xtype</span><span class=o>=</span><span class=s1>&#39;P&#39;</span> <span class=k>and</span> <span class=n>a</span><span class=p>.</span><span class=nb>text</span> <span class=k>like</span> <span class=s1>&#39;%abc%&#39;</span>
</code></pre></td></tr></table></div></div><h3 id=查询带关键字的列名>查询带关键字的列名</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=c1>--select columns name
</span><span class=c1></span><span class=k>select</span> <span class=n>b</span><span class=p>.</span><span class=n>name</span> <span class=k>as</span> <span class=n>Table1</span><span class=p>,</span> <span class=n>a</span><span class=p>.</span><span class=n>name</span> <span class=k>as</span> <span class=n>Columns1</span><span class=p>,</span><span class=n>a</span><span class=p>.</span><span class=k>type</span>  <span class=k>from</span> <span class=n>syscolumns</span> <span class=n>a</span> <span class=k>left</span> <span class=k>join</span> <span class=n>sysobjects</span> <span class=n>b</span> <span class=k>on</span> <span class=n>b</span><span class=p>.</span><span class=n>id</span><span class=o>=</span><span class=n>a</span><span class=p>.</span><span class=n>id</span>
<span class=k>where</span> <span class=n>b</span><span class=p>.</span><span class=n>xtype</span><span class=o>=</span><span class=s1>&#39;u&#39;</span> <span class=k>and</span> <span class=n>a</span><span class=p>.</span><span class=n>name</span> <span class=k>like</span> <span class=s1>&#39;%abc%&#39;</span>
</code></pre></td></tr></table></div></div><h3 id=查询带关键字的表名>查询带关键字的表名</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=c1>--select table name
</span><span class=c1></span><span class=k>select</span> <span class=n>name</span> <span class=k>from</span> <span class=n>sysobjects</span> <span class=k>where</span> <span class=n>xtype</span><span class=o>=</span><span class=s1>&#39;u&#39;</span> <span class=k>and</span> <span class=n>name</span> <span class=k>like</span> <span class=s1>&#39;%abc%&#39;</span>
</code></pre></td></tr></table></div></div><h3 id=查询带关键字的函数名>查询带关键字的函数名</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=c1>--select string using in function
</span><span class=c1></span><span class=k>select</span> <span class=n>b</span><span class=p>.</span><span class=n>name</span><span class=p>,</span> <span class=n>a</span><span class=p>.</span><span class=nb>text</span> <span class=k>from</span> <span class=n>syscomments</span> <span class=n>a</span> <span class=k>left</span> <span class=k>join</span> <span class=n>sysobjects</span> <span class=n>b</span> <span class=k>on</span> <span class=n>b</span><span class=p>.</span><span class=n>id</span><span class=o>=</span><span class=n>a</span><span class=p>.</span><span class=n>id</span>
<span class=k>where</span> <span class=n>b</span><span class=p>.</span><span class=n>xtype</span><span class=o>=</span><span class=s1>&#39;fn&#39;</span> <span class=k>and</span> <span class=n>a</span><span class=p>.</span><span class=nb>text</span> <span class=k>like</span> <span class=s1>&#39;%abc%&#39;</span>
</code></pre></td></tr></table></div></div><h3 id=查询带关键字的视图>查询带关键字的视图</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=c1>--select string using in view
</span><span class=c1></span><span class=k>select</span> <span class=n>b</span><span class=p>.</span><span class=n>name</span><span class=p>,</span> <span class=n>a</span><span class=p>.</span><span class=nb>text</span> <span class=k>from</span> <span class=n>syscomments</span> <span class=n>a</span> <span class=k>left</span> <span class=k>join</span> <span class=n>sysobjects</span> <span class=n>b</span> <span class=k>on</span> <span class=n>b</span><span class=p>.</span><span class=n>id</span><span class=o>=</span><span class=n>a</span><span class=p>.</span><span class=n>id</span>
<span class=k>where</span> <span class=n>b</span><span class=p>.</span><span class=n>xtype</span><span class=o>=</span><span class=s1>&#39;V&#39;</span> <span class=k>and</span> <span class=n>a</span><span class=p>.</span><span class=nb>text</span> <span class=k>like</span> <span class=s1>&#39;%abc%&#39;</span>
</code></pre></td></tr></table></div></div><blockquote><p>Written with <a href=https://stackedit.io/ target=_blank rel="noopener noreffer">StackEdit</a>.</p></blockquote></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-05-31</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://gethin1990.github.io/massive-data-optimization-notes/ data-title=海量数据优化笔记 data-hashtags=数据><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://gethin1990.github.io/massive-data-optimization-notes/ data-hashtag=数据><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://gethin1990.github.io/massive-data-optimization-notes/ data-title=海量数据优化笔记><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://gethin1990.github.io/massive-data-optimization-notes/ data-title=海量数据优化笔记><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://gethin1990.github.io/massive-data-optimization-notes/ data-title=海量数据优化笔记><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E6%95%B0%E6%8D%AE/>数据</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/gatsby-basic-knowledge-3/ class=prev rel=prev title=Gatsby基础知识（下）><i class="fas fa-angle-left fa-fw"></i>Gatsby基础知识（下）</a>
<a href=/python-learning-notes/ class=next rel=next title="PYTHON 学习笔记(Junior)">PYTHON 学习笔记(Junior)<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><span id=run-time></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://gethin.online/ target=_blank>Gethin</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><link rel=stylesheet href=/css/_custom.scss><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twemoji@13.0.0/dist/twemoji.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><script type=text/javascript src=/js/jquery.backstretch.min.js></script><script type=text/javascript src=/js/dayjs.min.js></script><script type=text/javascript src=/js/custom.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"valine":{"appId":"1VBUiSYKiwFzrfjxiAC91SxL-gzGzoHsz","appKey":"5bn6AC46BR6WSh3myVFN7yQ3","avatar":"mm","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"visitor":true}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"K8S9KF7M5S","algoliaIndex":"hugoblog_cn","algoliaSearchKey":"8ee76e5626e8145996a6c46fbdce0d23","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"twemoji":true};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>